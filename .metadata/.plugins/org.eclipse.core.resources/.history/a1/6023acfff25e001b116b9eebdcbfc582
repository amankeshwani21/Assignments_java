package com.thinkitive;

import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.SQLException;

import com.mysql.jdbc.Connection;
import com.mysql.jdbc.PreparedStatement;
import com.mysql.jdbc.Statement;

public class Dbconn 
	{
		
		  Statement st;
		  Connection con;
		  PreparedStatement ps;
		  
		public Dbconn() {
			
			try {
				Class.forName("com.mysql.jdbc.Driver");
			} catch (ClassNotFoundException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			}
		} 

		public Connection getconn() {
			try {
				con = (Connection) DriverManager.getConnection("jdbc:mysql://localhost:3306/mydb", "root", "admin");
			} catch (SQLException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			}
			return con;
		}

		public void close() {
			try {
				con.close();
			} catch (SQLException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			}
		}

		public Statement getStatement() {
			
			try {
				st=(Statement) this.getconn().createStatement();
			} catch (SQLException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			}
			return st;
			
		}

		public PreparedStatement prepared(String sql) {
			
			try {
				ps=(PreparedStatement) this.getconn().prepareStatement(sql);
			} catch (SQLException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			}
			return ps;
			
		}

		public void insertData(int id, String name) {
			PreparedStatement ps;
			ps=this.prepared("insert into Persons values(?,?)");
			try {
				ps.setInt(1, id);
				ps.setString(2, name);
				ps.execute();
				this.close();
			} catch (SQLException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			}	
		}
		public void updateData(String name, int id) {
			PreparedStatement ps;
			ps=this.prepared("update Persons set LastName=? where personID=?");
			try {
				ps.setString(1, name);
				ps.setInt(2, id);
				ps.execute();
				this.close();
			} catch (SQLException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			}
			
		}
		public void deleteData(int id) {
			PreparedStatement ps;
			ps=this.prepared("delete from Persons where personID=?");
			try {
				ps.setInt(1, id);
				ps.execute();
				ps.close();
			} catch (SQLException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			}
		}

		public void showData() {
			st = this.getStatement();

			try {
				ResultSet rs = st.executeQuery("select * from Persons");

				while (rs.next()) {
					System.out.println(rs.getInt(1) + " " + rs.getString(2));
				}

				this.close();
			} catch (SQLException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			}
		}

		}


